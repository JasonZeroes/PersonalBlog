# 个人博客网站	项目日志

## 一.	项目简介

​	本网站,旨在展示个人的学习工作经历, 将自己工作和生活种遇到的各种问题与各位博友进行分析和探讨.

## 二.	项目模块及准备工作

​	本项目一共分为三个模块:

​	准备工作:将应用都添加到apps的包文件夹中, 方便进行多应用的管理

## 三.	用户模块

​	用户模块涵盖用户注册, 用户登录, 用户修改密码等功能.

### 3.1	用户注册模块

#### 3.1.1需求分析

​	用户利用手机号码进行注册, 在用户注册完成后,可以在用户个人信息中心对用户的个人详细信息进行编辑.

#### 3.1.2流程实现

​	①用户在需要评论的时候, 需要验证用户是否已经登录, 只有在登录的情况下,用户才能进行评论.

​	②用户在等刘界面会有两种选择:

​		1): 没有账号, 需要前往注册界面, 进行用户的注册.

​		2): 拥有账号, 直接输入用户名和用户密码, 就可以直接进行登录.

​	③在没有账号的情况下,用户前往注册页面,用户输入手机号码(要验证用户的手机号码是否已经被注册和手机号码的合法性), 在手机号码正确的情况下, 用户点击获取  **获取验证码**  按钮, 回去用户的验证码, 在用户手机号码合法, 验证码合法和用户密码都合法的情况下, 才提示用户注册成功, 然后跳转到博客首页.

​	④用户注册流程实现.

#### 3.1.3模型与数据库交互

​	(1)	创建基础模型.	由于多张表都会涉及是否删除, 创建时间, 更新时间等字段, 故将其单独提取出来, 创建一个基础模型, 伺候模型继承该模型即可, 不必每张表都去单独创建这些字段.

​	(2)	创建用户模型:

​			分析用户模型所需要的字段:

​			①用户昵称: nickname=models.CharField(max_length=100)

​			②用户手机:phone=models.CharField(max_length=11)	在这里可以对电话号码进行验证

​			③用户密码:password=models.CharField(max_length=64)

​			④用户头像:head_portrait=models.ImageFiled(upload_to='head_portrait/%Y%m', default="head_portrait/    ")

​			⑤用户性别:sex=models.SmallIntegerField(choices=((1, "男"), (2, "女), (3, "保密)), default=3)

​			⑥用户状态:user_status=models.SmallLntegerField(choices=((1, "正常"), (2, "禁言"), (3, "禁止登陆")), default=1)

​			⑦用户积分: user_integral = models.DecimalField(max_digits=9, decimal_places=2, default=1000)

​			⑧用户购买博客文章: user_buyblogarticle = models.ManyToManyField(to="blog.BlogArticle")

​	(3)	将粉丝用户的传过来的密码利用sha-256进行加密处理, 考虑到加密函数会在注册和登录时,多次使用,故可以将其封装起来, 实现多次的调用



#### 3.1.4问题及难点

​	(1)	问题1:

​			能否前面创建的字段数据, 作为后面字段的默认值使用?

​			解决方式:  不能; 

​	(2)	问题2:

​			为什么在输入密码的时候, 输入全是空格的密码时, 提示的是没有输入密码?(即空格不能作为密码字符)

​			解决方式:

​	(3)	问题3:

​			能否创建一个函数, 生成一个指定长度的字符串, 分配给用户, 来达到没用用户的密码加盐不一样的目的?

​			解决方式:

​	(4)	问题4:

​			在进行用户创建的时候,是否要考虑数据库没有创建成功的情况,是否要将错误捕获抛出?

将接受的数据,保存到数据当中

try:    

​	UserModel.objects.create(phone=phone, password=password)

except:    

​	raise  抛出错误!



### 3.2 用户注册验证码模块

### 3.3用户登录模块

#### 3.3.1需求分析

​	在用户用户账号和密码的情况下, 用户输入手机号码和用户密码, 验证通过就登录成功, 就能查看用户个人中心和对博客进行评论, 同时, 每天登录还能领取用户登录积分.

#### 3.3.2流程实现

​	①用户输入手机号码和密码, 点击	**登录**	   按钮, 将手机号码和密码提交到后台.

​	②后台对用提交的电话号码和密码, 进行验证, 如果验证通过, 跳转到请求登录的网址, 如果上次请求的网址不存在, 就按跳转到博客首页; 如果验证不通过, 就回显用户提交的电话号码, 同时显示错误提示信息.

	#### 3.3.3与数据库交互

​	根据用户提交的信息, 现在form验证中对提交信息进行验证; 验证通过, 就到数据库查询对应的用户信息. 如果有该用户, 将用户信息保存到session中, 如果没有用户, 就返回对应的错误提示信息.

#### 3.3.4问题及难点

### 3.4用户积分模块

问题: 怎么实现登录赠送积分



## 四. 博客模块

### 4.1 博客首页模块

#### 4.1.1需求分析

​	在博客的首页, 将会展示博客的轮播图, 最新更新的博客文章, 搜索框, 博主信息, 博客标签等信息.

​	最新的博文信息, 只需要展示最新的20条数据即可.

#### 4.1.2流程实现

​	①根据博客个人信息, 查询博主最新的博文更新,博文标签等

#### 4.1.3模型与数据库交互

​	(1)	首先创建博客文章的分类模型

​		①分类名称: class_name=models.CharField(max_length=100)

​	(2)	创建博客文章模型

​		①博客标题: blog_title=models.CharField(max_length=200)

​		②博客内容: blog_content=models.TextField()

​		③博客权限: blog_status=models.SmallIntegerField(choices=((1, '0积分'),(2, '20积分'),(3, '30积分'),(4, '50积分')), default=1)

​			   设置博客查看所需要的条件: 即用户是否已经利用积分将该文章进行了购买. 如果对该文章已经进行了购买, 则永久获得该文章的阅读权限

​		④博客状态: models.BooleanField(choices=((True, "发表"), False, "未发表")), default=False)

​		⑤与博客分类建立外键连接(一对多): blogclassify = models.ForeignKey(to="BlogClassify")	

​		⑥和博客标签建立外键连接(多对多): blogtag = models.ManyToManyField(to="BlogTag")

​	(3)	 创建博客文章标签模型

​		①标签名称: tag_name=models.CharField(max_length=100)

​	(4)	创建博客首页轮播图片模型

​		①轮播名称: name=modls.CharField(max_length=200)

​		②轮播图片地址:img_url=models.ImageField(upload_to="carousel/%Y%m/%d")

​		③轮播图片排序:order=models.SmallIntegerField(default=0)

​		④与博客文章建立外键连接:blogarticle=models.ForeignKey(to="BlogArticle", )

#### 4.1.4文件上传及富文本编辑器的配置



#### 4.1.5问题及难点

​	难点1:

​		怎么实现用户不购买文章, 只能获取普通文章的权限, 但是在购买了对应的文章后, 永久获得该文章的阅读权限?

​	解决方法: 建立一个用户购买文章的表, 用来保存用户购买文章的id, 如果购买, 就永久有效.

​	问题1:

​		如果图片地址内容为空, 在DTL中怎么判断?

​	解决方法: 

​	问题2:

​		绑定点击事件失败?![1549801977412](C:\Users\1\AppData\Local\Temp\1549801977412.png)

解决方法:

### 4.2 博客分类显示模块

#### 4.2.1 需求分析

​	用户点击相应的分类, 会显示对应分类的文章, 每一页显示20篇文章.

#### 4.2.2 流程实现

​	①根据用户点击的博客文章分类id, 查询出该类的所有文章.

​	②显示博客的标题, 创建时间, 编辑者, 评论数, 第一段内容等信息.

​	③每一页显示20条该类文章.

#### 4.2.3 查询数据

​	根据点击的分类id, 查询出所有的文章, 每一页显示20条数据.

## 五. 用户评论模块

### 5.1 需求分析

​	当用户登录之后, 用户状态正常, 就能在博客文章的详情页对文章进行评论.

### 5.2 流程实现

​	①首先检查用户是否是登录状态.

​	②判断用户的状态, 看看是否合法, 如果不合法, 就不允许用户进行评论.(以ajax的方式提交数据, 可以实现弹窗)

​	③将用户多的评论内容保存到数据库, 同时将评论以倒序的方式, 以每页10条的条件展示在博客的详情页下面.

### 5.3 模型与数据库交互

​	(1)	创建用户评论模型

​		①评价内容: content=models.TextField()

​		②点击量: hits=models.

​	



​	

























